{"mtime":1373709655,"js":"var ajax, appliPicSrc, appliance_status, deviceStatistics, drawDetailPlot, fakePlot, groupApplication, hideLoading, jsonpURL, login, logout, onDeviceReady, refresh, refreshAppliDetail, refreshAppliList, refreshMain, selectIp, showLoading, sumOfAttr, uniqueDevId,\n  __slice = [].slice;\n\nNumber.prototype.fix = function(fixed, total) {\n  var dec, fl, num, _ref;\n\n  if (fixed == null) {\n    fixed = 2;\n  }\n  if (total == null) {\n    total = 4;\n  }\n  num = this.toFixed(fixed).toString();\n  _ref = num.split(\".\"), dec = _ref[0], fl = _ref[1];\n  if (dec.length >= total) {\n    return dec;\n  } else {\n    console.log(total - dec.length);\n    console.log(fl.slice(0, total - dec.length));\n    return \"\" + dec + \".\" + fl.slice(0, total - dec.length);\n  }\n};\n\nonDeviceReady = function() {\n  var loginInfo;\n\n  $(window).resize();\n  Base64.extendString();\n  loginInfo = $.jStorage.get(\"loginInfo\");\n  if ((loginInfo != null) && loginInfo[\"save_account\"]) {\n    $(\"#loginAccount\").val(loginInfo.account);\n    $(\"#loginPassword\").val(loginInfo.password);\n    $(\"#isSaveAccount\").prop('checked', loginInfo.save_account || false);\n  }\n  return console.log(\"onDeviceReady\");\n};\n\njsonpURL = function(source_url, param) {\n  var jsonp_url;\n\n  jsonp_url = new Uri((\"http://\" + (selectIp()) + \"/api/\") + source_url).setQuery(decodeURIComponent($.param(param))).toString();\n  console.log(jsonp_url);\n  return jsonp_url;\n};\n\nappliance_status = function(appli) {\n  var status;\n\n  status = \"off\";\n  if ((appli.report_time != null) && moment(appli.report_time).add(\"minutes\", 30).isBefore(moment())) {\n    status = \"offline\";\n  } else if (appli.status === \"on\") {\n    status = \"on\";\n    if (parseFloat(appli.act_power) === 0) {\n      status = \"unused\";\n    }\n  }\n  return status;\n};\n\nrefresh = function() {\n  console.log(\"refresh\");\n  if ($.jStorage.get(\"auth\") == null) {\n    return false;\n  }\n  return ajax(\"appliance/user\", {\n    cust_id: $.jStorage.get(\"user\").user_id,\n    auth: $.jStorage.get(\"auth\")\n  }).done(function(data) {\n    var a, status, _i, _len, _ref;\n\n    _ref = data.appliances;\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      a = _ref[_i];\n      status = appliance_status(a);\n      if (status === \"offline\" || status === \"unused\") {\n        a[\"act_power\"] = 0;\n      }\n    }\n    console.log(data);\n    window[\"appliance_user\"] = data;\n    refreshAppliList(data);\n    refreshMain(data);\n    return refreshAppliDetail(data);\n  });\n};\n\nrefreshAppliDetail = function(data) {\n  var info;\n\n  info = $(\"#appliDetail\").data(\"info\");\n  if (info == null) {\n    return;\n  }\n  return $(\"#appliList li[data-this='\" + info.dev_id + \"']\").trigger(\"touchend\");\n};\n\nrefreshAppliList = function(data) {\n  console.log('refreshAppliList');\n  $(\"#appliList\").empty();\n  return _.each(groupApplication(data).appliances, function(element, index, list) {\n    var bg, cord_appli_tmpl, cord_tmpl, li, picSrc, status_str, sub_appli, tmpl, _i, _len, _ref, _results;\n\n    tmpl = \"<li data-this=\\\"%s\\\" class=\\\"appli-li %s\\\"><span><img src=\\\"%s\\\" class=\\\"li-icon\\\"> <span class=\\\"li-text\\\">%s</span><span class=\\\"chevron\\\"></span><span class=\\\"count-%s\\\">%s</span></span></li>\";\n    cord_tmpl = \"<li data-this=\\\"%s\\\" class=\\\"appli-li %s %s\\\"><span><img src=\\\"%s\\\" class=\\\"li-icon-cord\\\"> <span class=\\\"chevron\\\"></span><span class=\\\"count-%s\\\">%s</span></span></li>\";\n    cord_appli_tmpl = \"<li data-this=\\\"%s\\\" class=\\\"appli-li sub %s\\\" data-parent=\\\"%s\\\"><span><img src=\\\"%s\\\" class=\\\"li-icon\\\"> <span class=\\\"li-text\\\">%s</span><span class=\\\"chevron\\\"></span></span></li>\";\n    if (element.dev_type !== \"06\") {\n      switch (appliance_status(element)) {\n        case \"on\":\n          bg = \"green\";\n          status_str = \"開啟\";\n          break;\n        case \"off\":\n          bg = \"yellow\";\n          status_str = \"關閉\";\n          break;\n        case \"offline\":\n          bg = \"black\";\n          status_str = \"斷線\";\n          break;\n        case \"unused\":\n          bg = \"gray\";\n          status_str = \"未使用\";\n      }\n      if (element.dev_type === \"cord\") {\n        picSrc = \"./images/extension_cord.png\";\n        li = $(_.str.sprintf(cord_tmpl, element.dev_id, bg, \"cord\", picSrc, bg, status_str));\n        li.data(\"info\", element);\n        li.data(\"toggle\", true);\n        li.find('.chevron').hide();\n        $(\"#appliList\").append(li);\n        _ref = element.appli;\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          sub_appli = _ref[_i];\n          picSrc = appliPicSrc(sub_appli.appliance_type, element.status);\n          li = $(_.str.sprintf(cord_appli_tmpl, sub_appli.dev_id, bg, element.dev_id, picSrc, sub_appli.appliance));\n          li.data(\"info\", sub_appli);\n          _results.push($(\"#appliList\").append(li));\n        }\n        return _results;\n      } else {\n        picSrc = appliPicSrc(element.appliance_type, element.status);\n        li = $(_.str.sprintf(tmpl, element.dev_id, bg, picSrc, element.appliance, bg, status_str));\n        li.data(\"info\", element);\n        return $(\"#appliList\").append(li);\n      }\n    }\n  });\n};\n\nrefreshMain = function(data) {\n  console.log('refreshMain');\n  $(\"#mainPower\").text(sumOfAttr(data.appliances, \"act_power\"));\n  $(\"#mainDayEnergy\").text(sumOfAttr(data.appliances, \"statistics\", \"day_energy\", 2, \"value\"));\n  $(\"#mainDayPower\").text(sumOfAttr(data.appliances, \"statistics\", \"day_power_rate\", 2, \"value\"));\n  $(\"#mainMonthEnergy\").text(sumOfAttr(data.appliances, \"statistics\", \"month_energy\", 2, \"value\"));\n  return $(\"#mainMonthPower\").text(sumOfAttr(data.appliances, \"statistics\", \"month_power_rate\", 2, \"value\"));\n};\n\nlogout = function() {\n  return Alertify.dialog.confirm(\"確定要現在就登出嗎？\", function() {\n    $.jStorage.deleteKey(\"auth\");\n    $.jStorage.deleteKey(\"user\");\n    $.jStorage.deleteKey(\"loginInfo\");\n    if (window.auto_refresh != null) {\n      window.auto_refresh.stop();\n    }\n    return location.reload();\n  });\n};\n\nlogin = function() {\n  var account, auth, password;\n\n  account = $(\"#loginAccount\").val();\n  password = $(\"#loginPassword\").val();\n  if (account === \"\" || password === \"\") {\n    return Alertify.dialog.alert(\"請輸入帳號及密碼！\");\n  }\n  auth = (account + \":\" + password).toBase64();\n  showLoading();\n  return ajax(\"auth/login\", {\n    auth: auth\n  }).done(function(data) {\n    console.log(data);\n    if (data.status === \"ok\") {\n      $.jStorage.set(\"auth\", auth);\n      $.jStorage.set(\"user\", data.user);\n      if ($('#isSaveAccount').prop('checked')) {\n        $.jStorage.set(\"loginInfo\", {\n          account: account,\n          password: password,\n          save_account: true\n        });\n      } else {\n        $.jStorage.deleteKey(\"loginInfo\");\n      }\n      return refresh().done(function() {\n        hideLoading();\n        window.auto_refresh = $.timer(refresh, 10 * 60 * 1000, true);\n        return switchPage('#main');\n      });\n    } else {\n      hideLoading();\n      Alertify.dialog.alert(\"帳號或密碼可能是錯的，請再試一次！\");\n      $(\"#loginAccount\").val(\"\");\n      return $(\"#loginPassword\").val(\"\");\n    }\n  });\n};\n\ndeviceStatistics = function(appli, stats_type, attr, from, to) {\n  var end_time, format, start_time, stats_type_num;\n\n  if (from == null) {\n    from = 0;\n  }\n  if (to == null) {\n    to = 0;\n  }\n  format = {\n    year: \"YYYY\",\n    month: \"YYYYMM\",\n    day: \"YYYYMMDD\",\n    hour: \"YYYYMMDDHH\"\n  };\n  stats_type_num = {\n    year: 1,\n    month: 2,\n    day: 3,\n    hour: 4\n  };\n  start_time = moment().add(stats_type, from).format(format[stats_type]);\n  end_time = moment().add(stats_type, to).format(format[stats_type]);\n  return ajax(\"device/statistics\", {\n    auth: $.jStorage.get(\"auth\"),\n    dev_type: appli.dev_type,\n    dev_id: appli.dev_id,\n    attr: attr,\n    stats_type: stats_type_num[stats_type],\n    start_time: start_time,\n    end_time: end_time\n  });\n};\n\najax = function(source_url, param) {\n  var xhr;\n\n  return xhr = $.ajax({\n    url: jsonpURL(source_url, param),\n    type: \"GET\",\n    dataType: \"jsonp\",\n    jsonp: \"jsonp\"\n  }).fail(function() {\n    console.log(source_url + \" ajax fail\");\n    return hideLoading();\n  }).done(function() {});\n};\n\nshowLoading = function(msg) {\n  hideLoading();\n  if (msg != null) {\n    window.loading_log = Alertify.log.info(msg, 0);\n  }\n  return $.blockUI({\n    message: \"<img src='css/images/ajax-loader.gif' />\",\n    css: {\n      backgroundColor: 'transparent',\n      border: '0px'\n    }\n  });\n};\n\nhideLoading = function() {\n  $.unblockUI();\n  if (window.loading_log != null) {\n    return window.loading_log.close();\n  }\n};\n\nsumOfAttr = function() {\n  var args, array;\n\n  args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];\n  array = args.shift();\n  while (args.length > 0) {\n    array = _.pluck(array, args.shift());\n  }\n  console.log(array);\n  return _.reduce(array, (function(memo, num) {\n    return memo + parseFloat(num);\n  }), 0).toFixed(2);\n};\n\nappliPicSrc = function(appli_type, status) {\n  switch (status) {\n    case \"On\":\n    case \"on\":\n    case true:\n      status = 1;\n      break;\n    case \"Off\":\n    case \"off\":\n    case false:\n      status = 0;\n  }\n  appli_type = (\"00\" + appli_type).slice(-2);\n  return \"./images/appli/pic\" + appli_type + \"_\" + status + \".png\";\n};\n\nselectIp = function() {\n  return $('#selectIP').val();\n};\n\nuniqueDevId = function(appli) {\n  return appli.dev_id.split(\"|\")[0];\n};\n\ngroupApplication = function(data) {\n  var appli, c, collect, cord, _i, _j, _k, _l, _len, _len1, _len2, _len3, _len4, _m, _ref, _ref1;\n\n  data = JSON.parse(JSON.stringify(data));\n  cord = _.uniq((function() {\n    var _i, _len, _ref, _results;\n\n    _ref = data.appliances;\n    _results = [];\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      appli = _ref[_i];\n      if (appli.dev_type === \"06\") {\n        _results.push(JSON.stringify({\n          dev_id: uniqueDevId(appli),\n          dev_type: \"cord\"\n        }));\n      }\n    }\n    return _results;\n  })());\n  cord = (function() {\n    var _i, _len, _results;\n\n    _results = [];\n    for (_i = 0, _len = cord.length; _i < _len; _i++) {\n      c = cord[_i];\n      _results.push(JSON.parse(c));\n    }\n    return _results;\n  })();\n  for (_i = 0, _len = cord.length; _i < _len; _i++) {\n    c = cord[_i];\n    data.appliances.push(c);\n  }\n  collect = [];\n  for (_j = 0, _len1 = cord.length; _j < _len1; _j++) {\n    c = cord[_j];\n    collect[c.dev_id] = [];\n  }\n  _ref = data.appliances;\n  for (_k = 0, _len2 = _ref.length; _k < _len2; _k++) {\n    appli = _ref[_k];\n    if (appli.dev_type === \"06\") {\n      collect[uniqueDevId(appli)].push(appli);\n    }\n  }\n  _ref1 = data.appliances;\n  for (_l = 0, _len3 = _ref1.length; _l < _len3; _l++) {\n    appli = _ref1[_l];\n    for (_m = 0, _len4 = cord.length; _m < _len4; _m++) {\n      c = cord[_m];\n      if (appli.dev_id === c.dev_id && appli.dev_type === \"cord\") {\n        appli[\"appli\"] = collect[c.dev_id];\n        appli[\"act_power\"] = sumOfAttr(appli[\"appli\"], \"act_power\");\n        appli[\"status\"] = _.pluck(appli[\"appli\"], \"status\")[0];\n      }\n    }\n  }\n  return data;\n};\n\nfakePlot = function(data, barWidth) {\n  var d, fake_data, i;\n\n  if (barWidth == null) {\n    barWidth = null;\n  }\n  fake_data = (function() {\n    var _results;\n\n    _results = [];\n    for (i in data) {\n      d = data[i];\n      _results.push({\n        time: \"d\" + i,\n        value: d\n      });\n    }\n    return _results;\n  })();\n  console.log(fake_data);\n  return drawDetailPlot(\"fakePlot\", fake_data, barWidth);\n};\n\ndrawDetailPlot = function(label, data, barWidth) {\n  var plot1, ticks, val;\n\n  if (barWidth == null) {\n    barWidth = null;\n  }\n  $(\"#detailChart\").empty();\n  val = _.map(_.pluck(data, \"value\"), function(n) {\n    n = parseFloat(n);\n    if (n < 0.01) {\n      n = 0;\n    }\n    return n;\n  });\n  ticks = _.pluck(data, \"time\");\n  plot1 = $.jqplot(\"detailChart\", [val], {\n    seriesDefaults: {\n      renderer: $.jqplot.BarRenderer,\n      rendererOptions: {\n        fillToZero: true,\n        barWidth: barWidth\n      },\n      pointLabels: {\n        show: true,\n        location: \"s\"\n      }\n    },\n    series: [\n      {\n        label: label\n      }\n    ],\n    legend: {\n      show: true,\n      location: \"s\",\n      placement: \"outsideGrid\"\n    },\n    axes: {\n      xaxis: {\n        renderer: $.jqplot.CategoryAxisRenderer,\n        ticks: ticks\n      },\n      yaxis: {\n        min: 0,\n        pad: 1.05,\n        tickOptions: {\n          formatString: \"%.2f\"\n        }\n      }\n    }\n  });\n  return console.log(plot1);\n};\n\n$(document).on(\"touchmove\", \"#appliList li\", function() {\n  return $(this).addClass(\"touchmove\");\n});\n\n$(document).on(\"touchend\", \"#appliList li\", function() {\n  var color, info, timer, toggle, _i, _len, _ref;\n\n  if ($(this).hasClass(\"touchmove\")) {\n    $(this).removeClass(\"touchmove\");\n    return;\n  }\n  info = $(this).data(\"info\");\n  console.log(info);\n  if (typeof info === \"undefined\" || info === null) {\n    return;\n  }\n  if (info.dev_type === \"cord\") {\n    toggle = $(this).data(\"toggle\");\n    console.log(!toggle, \"#appliList li[data-parent=\" + info.dev_id + \"]\");\n    if (toggle) {\n      $(\"#appliList li[data-parent=\" + info.dev_id + \"]\").slideLeftHide();\n    } else {\n      $(\"#appliList li[data-parent=\" + info.dev_id + \"]\").slideLeftShow();\n    }\n    $(this).data(\"toggle\", !toggle);\n    return;\n  }\n  $(\"#appliDetail\").data(\"info\", info);\n  _ref = [\"green\", \"red\", \"yellow\", \"gray\", \"black\"];\n  for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n    color = _ref[_i];\n    $(\"#appliDetail .detail-board\").removeClass(color);\n  }\n  $('#detailStatus').show();\n  switch (appliance_status(info)) {\n    case \"on\":\n      $(\"#appliDetail .detail-board\").addClass(\"green\");\n      break;\n    case \"off\":\n      $(\"#appliDetail .detail-board\").addClass(\"yellow\");\n      break;\n    case \"offline\":\n      $(\"#appliDetail .detail-board\").addClass(\"black\");\n      $('#detailStatus').hide();\n      break;\n    case \"unused\":\n      $(\"#appliDetail .detail-board\").addClass(\"gray\");\n  }\n  $(\"#detailTitle\").text(info.appliance);\n  $(\"#detailActPower\").text(Number(info.act_power).fix(2, 4));\n  $(\"#detailDayPower\").text(Number(info.statistics.day_power_rate[2].value).toFixed(2));\n  $(\"#detailDayEnergy\").text(Number(info.statistics.day_energy[2].value).toFixed(2));\n  $(\"#detailDayHour\").text((Number(info.statistics.day_active_time[0].value) / 60).toFixed(2));\n  $(\"#detailImg\").attr(\"src\", appliPicSrc(info.appliance_type, info.status));\n  timer = $.timer(function() {\n    $('#detailDayEnergyStat').trigger('touchend');\n    return toggleChange($(\"#detailStatus\")[0], info.status);\n  }).once(100);\n  switchPage('#appliDetail');\n  $('#appliDetail').scrollTop(0);\n  $('.back-button').data('backPage', '#appli');\n  return $('.back-button').show();\n});\n\n$(document).on(\"touchmove\", \"#settingList li\", function() {\n  return $(this).addClass(\"touchmove\");\n});\n\n$(document).on(\"touchend\", \"#settingList li\", function() {\n  if ($(this).hasClass(\"touchmove\")) {\n    $(this).removeClass(\"touchmove\");\n    return;\n  }\n  if ($(this).hasClass(\"nonback\")) {\n    return;\n  }\n  $('.back-button').data('backPage', '#setting');\n  return $('.back-button').show();\n});\n\n$(document).on(\"touchend\", \"#detailStatus\", function() {\n  var action, action_str, appli, cord, cord_appli, device_control, info,\n    _this = this;\n\n  info = $(\"#appliDetail\").data(\"info\");\n  action = \"on\";\n  if ($(this).hasClass(\"active\")) {\n    action = \"off\";\n  }\n  action_str = \"開啟\";\n  if (action === \"off\") {\n    action_str = \"關閉\";\n  }\n  device_control = function() {\n    var start_time;\n\n    showLoading(\"正與In-Snergy伺服器連線，大約需要16秒的運作時間，請耐心等待。\");\n    start_time = moment();\n    return ajax(\"device/control\", {\n      dev_type: info.dev_type,\n      dev_id: info.dev_id,\n      action: action,\n      auth: $.jStorage.get(\"auth\")\n    }).done(function(data) {\n      var fail_check, finished, timer;\n\n      fail_check = function(d) {\n        if (d.status === \"fail\") {\n          hideLoading();\n          Alertify.log.error(\"\" + info.appliance + \"已斷線，無法進行控制。\");\n        }\n        return d.status === \"fail\";\n      };\n      if (fail_check(data)) {\n        return;\n      }\n      finished = 0;\n      return timer = $.timer(function() {\n        return refresh().done(function(_data) {\n          var target;\n\n          if (fail_check(_data)) {\n            return;\n          }\n          if (start_time.add(\"seconds\", 30).isAfter(moment())) {\n            Alertify.dialog.alert(\"此動作已執行超過30秒，強制停止執行此動作。\");\n            return;\n          }\n          target = _.find(_data.appliances, function(obj) {\n            console.log(data);\n            return obj.dev_id === info.dev_id;\n          });\n          console.log(target.status, data.dev_status, target.status !== data.dev_status);\n          if (target.status !== data.dev_status || force_finish) {\n            return timer.once(5000);\n          } else {\n            if (finished < 2) {\n              finished++;\n              return timer.once(5000);\n            } else {\n              $(\"#detailImg\").attr(\"src\", appliPicSrc(target.appliance_type, target.status));\n              return hideLoading();\n            }\n          }\n        });\n      }).once();\n    });\n  };\n  switch (info.dev_type) {\n    case \"02\":\n    case \"07\":\n      return Alertify.dialog.confirm(\"您是否要\" + action_str + \"「\" + info.appliance + \"」？\", function() {\n        return device_control();\n      });\n    case \"03\":\n    case \"04\":\n      return Alertify.dialog.alert(\"單CT冷氣機不允許控制\");\n    case \"06\":\n      cord = ((function() {\n        var _i, _len, _ref, _results;\n\n        _ref = groupApplication(window[\"appliance_user\"]).appliances;\n        _results = [];\n        for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n          appli = _ref[_i];\n          if (appli.dev_id === uniqueDevId(info) && appli.dev_type === \"cord\") {\n            _results.push(appli);\n          }\n        }\n        return _results;\n      })())[0];\n      cord_appli = _.pluck(cord.appli, \"appliance\").join(\"、\");\n      return Alertify.dialog.confirm(\"您控制的是延長線的開關，當您\" + action_str + \"時，會使\" + cord_appli + \"一起\" + action_str + \"，您確定要執行嗎？\", function() {\n        return device_control();\n      });\n  }\n});\n\n$(document).on(\"touchend\", \".segmented-controller li\", function() {\n  var day_time_shorter, id, info, main_segment_control;\n\n  info = $(\"#appliDetail\").data(\"info\");\n  main_segment_control = function(hide_item, show_item) {\n    var show_option;\n\n    show_option = {\n      duration: 'fast',\n      step: function() {\n        return $('#appliDetail').scrollTop($('#appliDetail').height() + 20);\n      }\n    };\n    if ($(hide_item).is(\":visible\")) {\n      delete show_option.duration;\n    }\n    return $(hide_item).slideUp('fast', function() {\n      $(hide_item).find('li').removeClass(\"active\");\n      if (show_item != null) {\n        return $(show_item).slideDown(show_option);\n      }\n    });\n  };\n  day_time_shorter = function(stats) {\n    var s, _i, _len, _results;\n\n    _results = [];\n    for (_i = 0, _len = stats.length; _i < _len; _i++) {\n      s = stats[_i];\n      _results.push({\n        time: s.time.slice(4),\n        value: s.value\n      });\n    }\n    return _results;\n  };\n  switch ($(this).attr(\"id\")) {\n    case \"detailDayStat\":\n      if ($(this).hasClass('active')) {\n        main_segment_control(\"#detailDay\");\n      } else {\n        main_segment_control(\"#detailMonth\", \"#detailDay\");\n      }\n      break;\n    case \"detailMonthStat\":\n      if ($(this).hasClass('active')) {\n        main_segment_control(\"#detailMonth\");\n      } else {\n        main_segment_control(\"#detailDay\", \"#detailMonth\");\n      }\n      break;\n    case \"detailMonthPowerStat\":\n      drawDetailPlot(\"近三月用電統計(度)\", info.statistics.month_energy, 50);\n      break;\n    case \"detailMonthEnergyStat\":\n      drawDetailPlot(\"近三月花費統計(元)\", info.statistics.month_power_rate, 50);\n      break;\n    case \"detailDayPowerStat\":\n      drawDetailPlot(\"近三日用電統計(度)\", info.statistics.day_energy, 50);\n      break;\n    case \"detailDayEnergyStat\":\n      drawDetailPlot(\"近三日花費統計(元)\", info.statistics.day_power_rate, 50);\n      break;\n    case \"detailWeekPowerStat\":\n      showLoading(\"讀取統計資料中，請稍候...\");\n      deviceStatistics(info, 'day', 'energy', -6).done(function(stats_data) {\n        hideLoading();\n        return drawDetailPlot(\"近七日用電統計(度)\", day_time_shorter(stats_data.statistics));\n      });\n      break;\n    case \"detailWeekEnergyStat\":\n      showLoading(\"讀取統計資料中，請稍候...\");\n      deviceStatistics(info, 'day', 'power_rate', -6).done(function(stats_data) {\n        hideLoading();\n        return drawDetailPlot(\"近七日花費統計(元)\", day_time_shorter(stats_data.statistics));\n      });\n      break;\n    case \"detailHalfYearPowerStat\":\n      showLoading(\"讀取統計資料中，請稍候...\");\n      deviceStatistics(info, 'month', 'energy', -5).done(function(stats_data) {\n        hideLoading();\n        return drawDetailPlot(\"近半年用電統計(度)\", stats_data.statistics);\n      });\n      break;\n    case \"detailHalfYearEnergyStat\":\n      showLoading(\"讀取統計資料中，請稍候...\");\n      deviceStatistics(info, 'month', 'power_rate', -5).done(function(stats_data) {\n        hideLoading();\n        return drawDetailPlot(\"近半年花費統計(元)\", stats_data.statistics);\n      });\n  }\n  if ($(this).hasClass('active') && ((function() {\n    var _i, _len, _ref, _results;\n\n    _ref = [\"detailDayStat\", \"detailMonthStat\"];\n    _results = [];\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      id = _ref[_i];\n      if (id === $(this).attr(\"id\")) {\n        _results.push(id);\n      }\n    }\n    return _results;\n  }).call(this)).length > 0) {\n    return $(this).siblings('li').andSelf().removeClass(\"active\");\n  } else {\n    $(this).siblings('li').removeClass(\"active\");\n    return $(this).addClass(\"active\");\n  }\n});\n\n$(document).on(\"touchend\", \".back-button\", function() {\n  switchPage($(this).data('backPage'));\n  $(this).removeData('backPage');\n  return $(\"#appliDetail\").removeData('info');\n});\n\n$(document).on(\"touchend\", \".refresh-button\", function() {\n  console.log(\"refresh-button\");\n  showLoading();\n  return refresh().done(function() {\n    return hideLoading();\n  });\n});\n\n$(document).on(\"touchend\", \"#loginSubmit\", function() {\n  console.log(\"login\");\n  return login();\n});\n\n$(document).on(\"touchend\", \"#logoutSubmit\", function() {\n  return logout();\n});\n\n$(window).on(\"resize\", function() {\n  $(\".vertical-center\").each(function() {\n    return $(this).position({\n      of: $(this).parent(),\n      at: \"center center\",\n      my: \"center center\"\n    });\n  });\n  return $(window).off(\"resize\");\n});\n\ndocument.addEventListener(\"deviceready\", onDeviceReady, false);\n\n$(function() {\n  onDeviceReady();\n  fakePlot([0.77, 0.64, 0.35]);\n  return $('.date').text(moment().format('ddd, MMM Do, YYYY'));\n});\n"}